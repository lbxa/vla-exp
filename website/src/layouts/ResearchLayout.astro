---
import "../styles/global.css";
import Nav from '../components/Nav.astro';

export interface Props {
  title?: string;
  description?: string;
}

const { title = "Research Paper", description = "Academic research presentation" } = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <title>{title}</title>
    
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="vla-exp" />
    <link rel="manifest" href="/favicon/site.webmanifest" />
    
    <!-- KaTeX CSS for math rendering -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" as="style" onload="this.onload=null;this.rel='stylesheet';" />
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" /></noscript>
  </head>
  <body class="bg-white font-noto-sans leading-relaxed text-nerfies-gray-700">
    <Nav />

    <!-- Main content -->
    <main class="pt-20">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="mt-16 border-t border-nerfies-gray-200 bg-nerfies-gray-50">
      <div class="mx-auto max-w-4xl space-y-2 px-lg py-xl text-center text-sm text-nerfies-gray-600">
        
        <p>Website template adapted from <a href="https://keunhong.com/" class="text-nerfies-primary transition-colors duration-200 hover:text-nerfies-primary-hover hover:underline">Keunhong Park</a>, <a href="https://mgharbi.com/" class="text-nerfies-primary transition-colors duration-200 hover:text-nerfies-primary-hover hover:underline">MichaÃ«l Gharbi</a>, and <a href="https://jonbarron.info/" class="text-nerfies-primary transition-colors duration-200 hover:text-nerfies-primary-hover hover:underline">Jon Barron</a></p>
        
        <p>Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="text-nerfies-primary transition-colors duration-200 hover:text-nerfies-primary-hover hover:underline">Creative Commons Attribution ShareAlike 4.0 International</a></p>
        
        <p class="text-xs">Feel free to use the source code of this website, we just ask that you link back to this page in your footer.</p>
      </div>
    </footer>

    <script>

      // Heading anchor functionality
      function generateHeadingIds() {
        const headings = document.querySelectorAll('.prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6');
        
        headings.forEach(heading => {
          if (!heading.id) {
            const text = heading.textContent || '';
            const id = text
              .toLowerCase()
              .replace(/[^a-z0-9\s-]/g, '')
              .replace(/\s+/g, '-')
              .replace(/-+/g, '-')
              .replace(/^-|-$/g, '');
            
            if (id) {
              heading.id = id;
            }
          }
        });
      }

      function setupHeadingAnchors() {
        const headings = document.querySelectorAll<HTMLElement>('.prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6');
        
        headings.forEach(heading => {
          heading.addEventListener('click', async (e: MouseEvent) => {
            // Only trigger if we're hovering (icon is visible) or Meta/Ctrl key is pressed
            const afterStyles = window.getComputedStyle(heading, '::after');
            const isHovering = afterStyles.opacity !== '0';
            
            if (isHovering || e.metaKey || e.ctrlKey) {
              e.preventDefault();
              
              const headingId = heading.id;
              
              if (headingId) {
                const url = `${window.location.origin}${window.location.pathname}#${headingId}`;
                
                // Update URL
                history.pushState(null, '', `#${headingId}`);
                
                // Copy to clipboard
                try {
                  await navigator.clipboard.writeText(url);
                  
                  // Visual feedback - highlight P in Nerfies blue
                  heading.style.setProperty('--anchor-color', '#3273dc');
                  
                  setTimeout(() => {
                    heading.style.removeProperty('--anchor-content');
                    heading.style.removeProperty('--anchor-color');
                  }, 1000);
                } catch (err) {
                  console.warn('Failed to copy to clipboard:', err);
                }
              }
            }
          });
        });
      }

      // Wrap all prose tables in scrollable containers
      function wrapTables() {
        const proseTables = document.querySelectorAll('.prose table');
        
        proseTables.forEach(table => {
          // Skip if already wrapped
          if (table.parentElement?.classList.contains('table-wrapper')) {
            return;
          }
          
          // Create wrapper div
          const wrapper = document.createElement('div');
          wrapper.className = 'table-wrapper';
          
          // Insert wrapper before table and move table into wrapper
          table.parentNode?.insertBefore(wrapper, table);
          wrapper.appendChild(table);
        });
      }

      // Initialize all functionality
      document.addEventListener('DOMContentLoaded', () => {
        generateHeadingIds();
        setupHeadingAnchors();
        wrapTables();

        // Footer current year
        const yearElement = document.getElementById('current-year');
        if (yearElement) {
          yearElement.textContent = String(new Date().getFullYear());
        }
      });
    </script>
  </body>
</html>